# Strata

![Strata logo](docs/images/strata-logo.jpg)

Strata is a CLI tool to enhance your Terraform workflows with clear, concise summaries of plan changes. It doesn't modify your Terraform workflow or require any special configuration - it simply provides better visibility into what your Terraform plans will do, helping you make more informed decisions before applying changes.

## Plan Summaries

The main functionality of Strata is to generate comprehensive summaries of Terraform plan files. You can create a summary using the `strata plan summary` command. For detailed help on this and other commands, add the `--help` flag.

```shell
$ strata plan summary --help

Summarize a Terraform plan file

This command analyzes a Terraform plan file and provides a summary of the changes.
It can read both binary plan files and JSON plan files (from terraform show -json).

The summary includes:
- Plan information (Terraform version, workspace, backend)
- Statistical overview of changes (additions, modifications, deletions, replacements)
- Detailed resource changes with IDs and module information
- Highlighting of potentially dangerous changes

Examples:
  strata plan summary terraform.tfplan
  strata plan summary --output json terraform.tfplan
  strata plan summary --danger-threshold 5 terraform.tfplan
  strata plan summary --output html --file report.html terraform.tfplan

Usage:
  strata plan summary [flags] PLAN_FILE

Flags:
      --danger-threshold int   Threshold for highlighting dangerous changes (default 3)
  -h, --help                   help for summary
      --output string          Output format: table, json, html (default "table")
      --file string            File to write output to (in addition to stdout)
      --show-details           Show detailed resource changes (default true)
      --highlight-dangers      Highlight potentially dangerous changes (default true)

Global Flags:
      --config string   config file (default is ./strata.yaml or ~/.strata.yaml)
      --debug           Enable debug output
  -v, --verbose         Enable verbose output
```

Strata assumes that you're providing a valid Terraform plan file, either in binary format (as generated by `terraform plan -out=file.tfplan`) or in JSON format (as generated by `terraform show -json file.tfplan > plan.json`).

### Usage

An example for generating a plan summary would be:

```shell
$ strata plan summary terraform.tfplan
```

This will analyze the plan file and display a comprehensive summary with the following sections:

1. **Plan Information** - Details about the plan file, Terraform version, workspace, and backend
2. **Statistics Summary** - Counts of resources being added, modified, deleted, or replaced
3. **Resource Changes** - Detailed table of all resource changes with IDs and module information
4. **Danger Highlights** - Warning indicators for potentially risky changes

![](docs/images/strata-plan-summary.jpg)

### Output Formats

Strata supports multiple output formats to fit different use cases:

```shell
# Generate summary in JSON format
$ strata plan summary --output json terraform.tfplan

# Generate HTML report and save to file
$ strata plan summary --output html --file report.html terraform.tfplan

# Generate table output with custom danger threshold
$ strata plan summary --danger-threshold 5 terraform.tfplan
```

### Danger Highlights

Strata can identify and highlight potentially dangerous changes in your Terraform plans:

1. **Destructive Changes** - Resources being deleted or replaced
2. **Sensitive Resource Replacements** - Replacement of critical infrastructure components
3. **Sensitive Property Changes** - Modifications to properties that might cause service disruptions

You can configure which resources and properties are considered sensitive in your `strata.yaml` configuration file:

```yaml
sensitive_resources:
  - resource_type: aws_db_instance
  - resource_type: aws_ec2_instance
sensitive_properties:
  - resource_type: aws_instance
    property: user_data
```

When a sensitive resource is being replaced or a sensitive property is being modified, Strata will highlight it with a warning indicator (⚠️) and provide details about why the change is considered dangerous.

## Configuration

You can customize Strata's behavior using a configuration file. Strata will look for a file named `strata.yaml` in the current directory or your home directory, or you can specify a custom file using the `--config` flag.

Example configuration:

```yaml
output: table
table:
  style: ColoredBlackOnMagentaWhite
plan:
  danger-threshold: 3
  show-details: true
  highlight-dangers: true

# Sensitive resources and properties configuration
sensitive_resources:
  - resource_type: aws_db_instance
  - resource_type: aws_ec2_instance
sensitive_properties:
  - resource_type: aws_instance
    property: user_data
```

## Installation

### Prerequisites
- Go 1.24.1 or higher
- Terraform 1.6+ (for testing)

### From Source

```bash
# Clone the repository
git clone https://github.com/yourusername/strata.git
cd strata

# Build the project
go build -o strata

# Install locally
go install
```

### Using Go Install

```bash
go install github.com/yourusername/strata@latest
```

## Development

Strata uses a standard Go project structure with the following components:

```
strata/
├── cmd/                  # Command-line interface definitions
├── config/               # Configuration management
├── docs/                 # Documentation
├── lib/                  # Core library code
│   └── plan/             # Terraform plan processing
├── main.go               # Application entry point
└── strata.yaml           # Default configuration file
```

### Building and Testing

```bash
# Build the project
make build

# Run tests
make test

# Run sample tests
make run-sample

# Run sample tests with detailed output
make run-sample-details
```

## Recent Changes

Recent additions to Strata include:

- Danger Highlights feature for identifying sensitive resource replacements and property changes
- Enhanced plan information display with Terraform version, workspace, and backend details
- Improved resource changes table with physical IDs, replacement indicators, and module information
- Horizontal statistics summary table with clear counts of different change types
- Makefile with standard development targets for building, testing, and running samples

For a complete list of changes, see the [changelog](changelog.md).

## Contributions

If you wish to contribute in any way (reporting bugs, requesting features, writing code), feel free to do so either by opening Issues or Pull Requests. For Pull Requests, just follow the standard pattern:

1. Fork the repository
2. Make your changes
3. Make a pull request that explains what it does

## License

Strata is licensed under the MIT License.